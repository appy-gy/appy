// Generated by CoffeeScript 1.9.3
self.addEventListener('push', function(event) {
  return event.waitUntil(fetch('/api/private/browser_notifications', {
    credentials: 'include'
  }).then(function(response) {
    return response.json().then(function(arg) {
      var body, icon, id, notification, ref, tag, title, url;
      notification = arg.notification;
      if (notification.payload.url == null) {
        return;
      }
      id = notification.id;
      ref = notification.payload, title = ref.title, body = ref.body, icon = ref.icon, tag = ref.tag, url = ref.url;
      return self.registration.showNotification(title, {
        body: body,
        icon: icon,
        tag: tag,
        data: {
          id: id,
          url: url
        }
      });
    });
  }));
});

self.addEventListener('notificationclick', function(event) {
  var id, ref, url;
  event.notification.close();
  if (clients.openWindow == null) {
    return;
  }
  ref = event.notification.data, id = ref.id, url = ref.url;
  clients.openWindow(url);
  return event.waitUntil(fetch("/api/private/browser_notifications/" + id + "/click", {
    method: 'put',
    credentials: 'include'
  }));
});
